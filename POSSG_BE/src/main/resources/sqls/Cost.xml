<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="possg.com.a.dao.CostDao">

<!-- 월세 관리비 입력 -->
<insert id="addcost" parameterType="possg.com.a.dto.CostDto">
	insert into Cost(rent, water_bill, electricity_bill, gas_bill, total_labor_cost, security_maintenance_fee, conv_seq, cost_year, cost_month)
	values(#{rent}, #{waterBill}, #{electricityBill}, #{gasBill}, #{totalLaborCost}, #{securityMaintenanceFee},(select conv_seq from Convenience where conv_seq = #{convSeq}), #{costYear}, #{costMonth})
</insert>

<update id="updatecost" parameterType="possg.com.a.dto.CostDto">
	update Cost
	set rent = #{rent},
	water_bill = #{waterBill},
	electricity_bill = #{electricityBill},
	gas_bill = #{gasBill},
	total_labor_cost = #{totalLaborCost},
	security_maintenance_fee = #{securityMaintenanceFee}
	
	where conv_seq = #{convSeq} AND cost_year = #{costYear} AND cost_month = #{costMonth} 
</update>

<!-- 매출 -->
<select id="selectSales" parameterType="possg.com.a.dto.CostParam" resultType="possg.com.a.dto.CostParam">
	select 
	d.ref,
	(select del_total_price from delivery_list where dl.del_ref = d.ref) as delTotalPrice, 
	(select price from payment where conv_seq = #{convSeq}) as paymentPrice,
	c.branch_name	

	from Convenience as c	
	inner join delivery d on c.branch_name = d.branch_name
	inner join payment p on c.conv_seq = p.conv_seq
	inner join delivery_list dl on d.ref = dl.del_ref
 	
	<choose>
		<when test="choice == 0"><!-- day -->
			where c.conv_seq = #{convSeq}
		</when>
		
		<when test="choice == 1"><!-- week -->
			where c.conv_seq = #{convSeq} and d.order_status != 0
		</when>
		
		<when test="choice == 2"><!-- month -->
			where c.conv_seq = #{convSeq} and d.order_status != 0
		</when>
		
		<otherwise>
            <!-- 기본 쿼리 (예: choice에 맞지 않는 경우) -->
            where c.conv_seq = #{convSeq}
        </otherwise>
	</choose>

</select>




<select id="paymentProductName" parameterType="Integer" resultType="possg.com.a.dto.ProductDto">
	select *
	from product
	where product_seq = #{productSeq}
</select>

</mapper>